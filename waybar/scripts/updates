#!/usr/bin/env bash

# Script: updates
# Verifica actualizaciones en Arch Linux y muestra icono + número directamente en text

# Verificar si es Arch Linux
if [ ! -f /etc/arch-release ]; then
    echo '{"text": "  0"}'
    exit 0
fi

# Verificar comandos necesarios
if ! command -v yay &>/dev/null; then
    echo '{"text": "  yay no instalado"}'
    exit 1
fi

if ! command -v checkupdates &>/dev/null; then
    echo '{"text": "  checkupdates no instalado"}'
    exit 1
fi

# Obtener actualizaciones
AUR=$(yay -Qua | wc -l)
OFFICIAL=$(checkupdates | wc -l)
COUNT=$((OFFICIAL + AUR))

# Generar salida con icono + número directamente en text
if [ "$COUNT" -eq 0 ]; then
    echo '{"text": "  0"}'
else
    echo "{\"text\": \"  $COUNT\"}"
fi

# Ejecutar actualización si se pasa 'update' como argumento
if [ "$1" = "update" ]; then
    if command -v kitty &>/dev/null; then
        setsid kitty --start-as=fullscreen --title all_is_kitty --hold sh -c 'yay -Syu' & disown
    else
        echo '{"text": "  Kitty no instalado"}'
        exit 1
    fi
fi

