#!/usr/bin/env bash

# Script: wall
# Propósito:
# Seleccionar un wallpaper aleatorio y aplicarlo con transición usando swww en Wayland (Hyprland).

# ==============================
# Configuración de la carpeta de wallpapers
WALLPAPER_DIR="${WALLPAPER_DIR:-$HOME/Imágenes/Wallpapers}"

# Verificar si la carpeta existe
if [ ! -d "$WALLPAPER_DIR" ]; then
    echo "Error: WALLPAPER_DIR ($WALLPAPER_DIR) no existe o no es un directorio."
    exit 1
fi

# ==============================
# Verificar si swww está instalado
if ! command -v swww &>/dev/null; then
    echo "Error: swww no está instalado."
    exit 1
fi

# Inicializar swww si no está iniciado
if ! swww query &>/dev/null; then
    swww init
fi

# ==============================
# Seleccionar una imagen aleatoria
IMAGE=$(find "$WALLPAPER_DIR" -type f \( -iname "*.png" -o -iname "*.jpg" -o -iname "*.jpeg" \) | shuf -n 1)

# Verificar si se encontró una imagen
if [ -z "$IMAGE" ]; then
    echo "Error: No se encontraron imágenes en $WALLPAPER_DIR"
    exit 1
fi

# ==============================
# Establecer wallpaper con transición
swww img "$IMAGE" \
    --transition-fps 60 \
    --transition-type grow \
    --transition-pos 0.925,0.977 \
    --transition-duration 2

exit 0

